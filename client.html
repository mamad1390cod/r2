<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Restaurant | Ø±Ø³ØªÙˆØ±Ø§Ù† Ø±ÙˆÛŒØ§Ù„</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { font-family: 'Vazirmatn', sans-serif; }
        :root {
            --gold: #D4AF37;
            --gold-light: #F4E4BA;
            --dark: #0D0D0D;
            --dark-light: #1A1A1A;
            --dark-medium: #2D2D2D;
        }
        body {
            background: linear-gradient(135deg, #0D0D0D 0%, #1A1A1A 50%, #0D0D0D 100%);
            min-height: 100vh;
        }
        .gold-gradient {
            background: linear-gradient(135deg, #D4AF37 0%, #F4E4BA 50%, #D4AF37 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .gold-border {
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        .gold-glow {
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.2);
        }
        .card-hover {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(212, 175, 55, 0.15);
        }
        .btn-gold {
            background: linear-gradient(135deg, #D4AF37 0%, #B8962D 100%);
            transition: all 0.3s ease;
        }
        .btn-gold:hover {
            background: linear-gradient(135deg, #F4E4BA 0%, #D4AF37 100%);
            transform: scale(1.02);
        }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .category-active {
            background: linear-gradient(135deg, #D4AF37 0%, #B8962D 100%);
            color: #0D0D0D;
        }
        .bottom-nav {
            background: linear-gradient(180deg, rgba(13, 13, 13, 0.95) 0%, rgba(26, 26, 26, 0.98) 100%);
            backdrop-filter: blur(20px);
        }
        .product-image {
            aspect-ratio: 1;
            object-fit: cover;
        }
        .rtl { direction: rtl; text-align: right; }
        .ltr { direction: ltr; text-align: left; }
        input, textarea, select {
            background: #2D2D2D !important;
            border: 1px solid rgba(212, 175, 55, 0.3) !important;
            color: white !important;
        }
        input:focus, textarea:focus, select:focus {
            border-color: #D4AF37 !important;
            outline: none !important;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.2) !important;
        }
        .discount-badge {
            background: linear-gradient(135deg, #FF4757 0%, #FF6B7A 100%);
        }
    </style>
</head>
<body class="text-white">
    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-gradient-to-b from-black/95 to-transparent backdrop-blur-md">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-[#D4AF37] to-[#B8962D] flex items-center justify-center">
                        <i class="fas fa-crown text-black text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold gold-gradient" data-translate="siteName">Ø±Ø³ØªÙˆØ±Ø§Ù† Ø±ÙˆÛŒØ§Ù„</h1>
                        <p class="text-xs text-gray-400" data-translate="siteSlogan">ØªØ¬Ø±Ø¨Ù‡ Ø·Ø¹Ù… Ù„ÙˆÚ©Ø³</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <div class="relative">
                        <button id="langBtn" class="flex items-center gap-2 px-3 py-2 rounded-lg gold-border hover:bg-white/5 transition">
                            <span id="currentLang">ğŸ‡®ğŸ‡·</span>
                            <i class="fas fa-chevron-down text-xs text-[#D4AF37]"></i>
                        </button>
                        <div id="langDropdown" class="hidden absolute top-full right-0 mt-2 bg-[#1A1A1A] rounded-lg gold-border overflow-hidden min-w-[120px]">
                            <button onclick="setLanguage('fa')" class="w-full px-4 py-2 hover:bg-white/5 flex items-center gap-2"><span>ğŸ‡®ğŸ‡·</span> ÙØ§Ø±Ø³ÛŒ</button>
                            <button onclick="setLanguage('en')" class="w-full px-4 py-2 hover:bg-white/5 flex items-center gap-2"><span>ğŸ‡¬ğŸ‡§</span> English</button>
                            <button onclick="setLanguage('ar')" class="w-full px-4 py-2 hover:bg-white/5 flex items-center gap-2"><span>ğŸ‡¸ğŸ‡¦</span> Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
                        </div>
                    </div>
                    <button onclick="showCart()" class="relative p-2">
                        <i class="fas fa-shopping-bag text-xl text-[#D4AF37]"></i>
                        <span id="cartBadge" class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs flex items-center justify-center hidden">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-24 pb-24">
        <!-- Hero Section -->
        <section class="container mx-auto px-4 mb-8">
            <div class="relative rounded-2xl overflow-hidden gold-border gold-glow">
                <div class="absolute inset-0 bg-gradient-to-r from-black/80 to-transparent z-10"></div>
                <img src="https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=1200" alt="Restaurant" class="w-full h-48 md:h-64 object-cover">
                <div class="absolute inset-0 z-20 flex flex-col justify-center p-6 md:p-10">
                    <h2 class="text-2xl md:text-4xl font-bold mb-2 gold-gradient" data-translate="heroTitle">Ø¨Ù‡ Ø¯Ù†ÛŒØ§ÛŒ Ø·Ø¹Ù…â€ŒÙ‡Ø§ÛŒ Ø´Ø§Ù‡Ø§Ù†Ù‡ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</h2>
                    <p class="text-gray-300 text-sm md:text-base" data-translate="heroSubtitle">Ø³ÙØ§Ø±Ø´ Ø¢Ù†Ù„Ø§ÛŒÙ† ØºØ°Ø§Ù‡Ø§ÛŒ Ù„ÙˆÚ©Ø³ Ø¨Ø§ Ú©ÛŒÙÛŒØª Ø¨Ø±ØªØ±</p>
                </div>
            </div>
        </section>

        <!-- Categories -->
        <section class="container mx-auto px-4 mb-6">
            <div id="categoriesContainer" class="flex gap-3 overflow-x-auto scrollbar-hide py-2">
                <!-- Loaded dynamically -->
            </div>
        </section>

        <!-- Products Grid -->
        <section class="container mx-auto px-4">
            <div id="productsGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <!-- Loaded dynamically -->
            </div>
        </section>
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bottom-nav gold-border border-b-0 rounded-t-3xl z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-around items-center py-3">
                <button onclick="showCart()" class="flex flex-col items-center gap-1 text-gray-400 hover:text-[#D4AF37] transition">
                    <i class="fas fa-shopping-cart text-xl"></i>
                    <span class="text-xs" data-translate="cart">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</span>
                </button>
                <button onclick="showAccount()" class="flex flex-col items-center gap-1 text-gray-400 hover:text-[#D4AF37] transition">
                    <i class="fas fa-user text-xl"></i>
                    <span class="text-xs" data-translate="account">Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ</span>
                </button>
                <button onclick="showSupport()" class="flex flex-col items-center gap-1 text-gray-400 hover:text-[#D4AF37] transition">
                    <i class="fas fa-headset text-xl"></i>
                    <span class="text-xs" data-translate="support">Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</span>
                </button>
                <button onclick="showOrders()" class="flex flex-col items-center gap-1 text-gray-400 hover:text-[#D4AF37] transition">
                    <i class="fas fa-box text-xl"></i>
                    <span class="text-xs" data-translate="myOrders">Ø³ÙØ§Ø±Ø´Ø§Øª Ù…Ù†</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Cart Modal -->
    <div id="cartModal" class="fixed inset-0 z-[100] hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeCart()"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-[#1A1A1A] rounded-t-3xl gold-border border-b-0 max-h-[85vh] overflow-hidden animate-fade-in">
            <div class="p-4 border-b border-white/10 flex items-center justify-between">
                <h3 class="text-xl font-bold gold-gradient" data-translate="shoppingCart">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</h3>
                <button onclick="closeCart()" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="cartItems" class="p-4 overflow-y-auto max-h-[40vh]">
                <!-- Loaded dynamically -->
            </div>
            <div class="p-4 border-t border-white/10">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-gray-400" data-translate="total">Ø¬Ù…Ø¹ Ú©Ù„:</span>
                    <span id="cartTotal" class="text-2xl font-bold text-[#D4AF37]">0 OMR</span>
                </div>
                <button onclick="showCheckout()" class="w-full btn-gold text-black font-bold py-4 rounded-xl" data-translate="checkout">ØªÚ©Ù…ÛŒÙ„ Ø³ÙØ§Ø±Ø´</button>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="fixed inset-0 z-[100] hidden overflow-y-auto">
        <div class="modal-backdrop absolute inset-0" onclick="closeCheckout()"></div>
        <div class="relative min-h-screen flex items-center justify-center p-4">
            <div class="relative bg-[#1A1A1A] rounded-2xl gold-border w-full max-w-lg max-h-[90vh] overflow-y-auto animate-fade-in">
                <div class="sticky top-0 bg-[#1A1A1A] p-4 border-b border-white/10 flex items-center justify-between z-10">
                    <h3 class="text-xl font-bold gold-gradient" data-translate="orderForm">ÙØ±Ù… Ø³ÙØ§Ø±Ø´</h3>
                    <button onclick="closeCheckout()" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="orderForm" class="p-4 space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1" data-translate="firstName">Ù†Ø§Ù…</label>
                            <input type="text" name="firstName" required class="w-full px-4 py-3 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1" data-translate="lastName">Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
                            <input type="text" name="lastName" required class="w-full px-4 py-3 rounded-xl">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1" data-translate="phone">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
                        <input type="tel" name="phone" required class="w-full px-4 py-3 rounded-xl">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1" data-translate="address">Ø¢Ø¯Ø±Ø³</label>
                        <textarea name="address" rows="2" required class="w-full px-4 py-3 rounded-xl resize-none"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1" data-translate="location">Ù„ÙˆÚ©ÛŒØ´Ù†</label>
                        <div class="flex gap-2">
                            <input type="text" name="location" id="locationInput" readonly class="flex-1 px-4 py-3 rounded-xl" placeholder="Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯">
                            <button type="button" onclick="getLocation()" class="px-4 py-3 btn-gold rounded-xl text-black">
                                <i class="fas fa-map-marker-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1" data-translate="notes">ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÙ‡</label>
                        <textarea name="notes" rows="2" class="w-full px-4 py-3 rounded-xl resize-none"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2" data-translate="contactMethod">Ø±Ø§Ù‡ Ø§Ø±ØªØ¨Ø§Ø·</label>
                        <div class="flex gap-3">
                            <label class="flex-1 flex items-center justify-center gap-2 p-3 rounded-xl gold-border cursor-pointer hover:bg-white/5">
                                <input type="radio" name="contactMethod" value="whatsapp" checked class="hidden">
                                <i class="fab fa-whatsapp text-green-500"></i>
                                <span>ÙˆØ§ØªØ³Ø§Ù¾</span>
                            </label>
                            <label class="flex-1 flex items-center justify-center gap-2 p-3 rounded-xl gold-border cursor-pointer hover:bg-white/5">
                                <input type="radio" name="contactMethod" value="telegram" class="hidden">
                                <i class="fab fa-telegram text-blue-500"></i>
                                <span>ØªÙ„Ú¯Ø±Ø§Ù…</span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2" data-translate="deliveryType">Ù†ÙˆØ¹ ØªØ­ÙˆÛŒÙ„</label>
                        <div class="flex gap-3">
                            <label class="flex-1 flex items-center justify-center gap-2 p-3 rounded-xl gold-border cursor-pointer hover:bg-white/5">
                                <input type="radio" name="deliveryType" value="delivery" checked class="hidden">
                                <i class="fas fa-truck text-[#D4AF37]"></i>
                                <span data-translate="delivery">Ø§Ø±Ø³Ø§Ù„</span>
                            </label>
                            <label class="flex-1 flex items-center justify-center gap-2 p-3 rounded-xl gold-border cursor-pointer hover:bg-white/5">
                                <input type="radio" name="deliveryType" value="pickup" class="hidden">
                                <i class="fas fa-walking text-[#D4AF37]"></i>
                                <span data-translate="pickup">Ø­Ø¶ÙˆØ±ÛŒ</span>
                            </label>
                        </div>
                    </div>
                    <div class="border-t border-white/10 pt-4">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-gray-400" data-translate="totalPayable">Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª:</span>
                            <div class="text-left">
                                <div id="checkoutTotalOMR" class="text-xl font-bold text-[#D4AF37]">0 OMR</div>
                                <div id="checkoutTotalUSD" class="text-sm text-gray-400">â‰ˆ $0 USD</div>
                            </div>
                        </div>
                        <button type="submit" id="payButton" class="w-full btn-gold text-black font-bold py-4 rounded-xl flex items-center justify-center gap-2">
                            <i class="fab fa-paypal"></i>
                            <span data-translate="payWithPaypal">Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ PayPal</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Product Detail Modal -->
    <div id="productModal" class="fixed inset-0 z-[100] hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeProductModal()"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-[#1A1A1A] rounded-t-3xl gold-border border-b-0 max-h-[85vh] overflow-hidden animate-fade-in">
            <div id="productModalContent">
                <!-- Content -->
            </div>
        </div>
    </div>

    <!-- Account, Support, Orders Modals (Simplified for structure) -->
    <!-- Account Modal -->
    <div id="accountModal" class="fixed inset-0 z-[100] hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeAccount()"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-[#1A1A1A] rounded-t-3xl gold-border border-b-0 max-h-[85vh] overflow-hidden animate-fade-in">
            <div class="p-4 border-b border-white/10 flex items-center justify-between">
                <h3 class="text-xl font-bold gold-gradient" data-translate="myAccount">Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ</h3>
                <button onclick="closeAccount()" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-4 text-center py-8">
                <div class="w-20 h-20 rounded-full bg-gradient-to-br from-[#D4AF37] to-[#B8962D] flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-user text-3xl text-black"></i>
                </div>
                <p class="text-gray-400" data-translate="guestUser">Ú©Ø§Ø±Ø¨Ø± Ù…Ù‡Ù…Ø§Ù†</p>
            </div>
        </div>
    </div>

    <!-- Support Modal -->
    <div id="supportModal" class="fixed inset-0 z-[100] hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeSupport()"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-[#1A1A1A] rounded-t-3xl gold-border border-b-0 max-h-[85vh] overflow-hidden animate-fade-in">
            <div class="p-4 border-b border-white/10 flex items-center justify-between">
                <h3 class="text-xl font-bold gold-gradient" data-translate="supportTitle">Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</h3>
                <button onclick="closeSupport()" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-4 space-y-4">
                <a href="https://wa.me/96812345678" class="flex items-center gap-4 p-4 rounded-xl gold-border hover:bg-white/5 transition">
                    <div class="w-12 h-12 rounded-full bg-green-500/20 flex items-center justify-center"><i class="fab fa-whatsapp text-2xl text-green-500"></i></div>
                    <div><div class="font-bold">WhatsApp</div><div class="text-sm text-gray-400">+968 1234 5678</div></div>
                </a>
                <a href="tel:+96812345678" class="flex items-center gap-4 p-4 rounded-xl gold-border hover:bg-white/5 transition">
                    <div class="w-12 h-12 rounded-full bg-[#D4AF37]/20 flex items-center justify-center"><i class="fas fa-phone text-2xl text-[#D4AF37]"></i></div>
                    <div><div class="font-bold" data-translate="callUs">ØªÙ…Ø§Ø³ Ù…Ø³ØªÙ‚ÛŒÙ…</div><div class="text-sm text-gray-400">+968 1234 5678</div></div>
                </a>
            </div>
        </div>
    </div>

    <!-- Orders Modal -->
    <div id="ordersModal" class="fixed inset-0 z-[100] hidden overflow-y-auto">
        <div class="modal-backdrop absolute inset-0" onclick="closeOrders()"></div>
        <div class="relative min-h-screen flex items-center justify-center p-4">
            <div class="relative bg-[#1A1A1A] rounded-2xl gold-border w-full max-w-lg max-h-[90vh] overflow-y-auto animate-fade-in">
                <div class="sticky top-0 bg-[#1A1A1A] p-4 border-b border-white/10 flex items-center justify-between z-10">
                    <h3 class="text-xl font-bold gold-gradient" data-translate="myOrdersTitle">Ø³ÙØ§Ø±Ø´Ø§Øª Ù…Ù†</h3>
                    <button onclick="closeOrders()" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center"><i class="fas fa-times"></i></button>
                </div>
                <div id="ordersList" class="p-4 space-y-4">
                    <!-- Loaded dynamically via LocalStorage of order IDs -->
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-[#1A1A1A] text-white px-6 py-3 rounded-xl gold-border shadow-lg z-[400] hidden">
        <span id="toastMessage"></span>
    </div>

    <script>
        // Translations
        const translations = {
            fa: {
                siteName: 'Ø±Ø³ØªÙˆØ±Ø§Ù† Ø±ÙˆÛŒØ§Ù„', siteSlogan: 'ØªØ¬Ø±Ø¨Ù‡ Ø·Ø¹Ù… Ù„ÙˆÚ©Ø³', heroTitle: 'Ø¨Ù‡ Ø¯Ù†ÛŒØ§ÛŒ Ø·Ø¹Ù…â€ŒÙ‡Ø§ÛŒ Ø´Ø§Ù‡Ø§Ù†Ù‡ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯', heroSubtitle: 'Ø³ÙØ§Ø±Ø´ Ø¢Ù†Ù„Ø§ÛŒÙ† ØºØ°Ø§Ù‡Ø§ÛŒ Ù„ÙˆÚ©Ø³ Ø¨Ø§ Ú©ÛŒÙÛŒØª Ø¨Ø±ØªØ±', allItems: 'Ù‡Ù…Ù‡', cart: 'Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯', account: 'Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ', support: 'Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ', myOrders: 'Ø³ÙØ§Ø±Ø´Ø§Øª Ù…Ù†', shoppingCart: 'Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯', total: 'Ø¬Ù…Ø¹ Ú©Ù„:', checkout: 'ØªÚ©Ù…ÛŒÙ„ Ø³ÙØ§Ø±Ø´', orderForm: 'ÙØ±Ù… Ø³ÙØ§Ø±Ø´', firstName: 'Ù†Ø§Ù…', lastName: 'Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ', phone: 'Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³', address: 'Ø¢Ø¯Ø±Ø³', location: 'Ù„ÙˆÚ©ÛŒØ´Ù†', notes: 'ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÙ‡', contactMethod: 'Ø±Ø§Ù‡ Ø§Ø±ØªØ¨Ø§Ø·', deliveryType: 'Ù†ÙˆØ¹ ØªØ­ÙˆÛŒÙ„', delivery: 'Ø§Ø±Ø³Ø§Ù„', pickup: 'Ø­Ø¶ÙˆØ±ÛŒ', totalPayable: 'Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª:', payWithPaypal: 'Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ PayPal', myAccount: 'Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ', guestUser: 'Ú©Ø§Ø±Ø¨Ø± Ù…Ù‡Ù…Ø§Ù†', supportTitle: 'Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ', callUs: 'ØªÙ…Ø§Ø³ Ù…Ø³ØªÙ‚ÛŒÙ…', myOrdersTitle: 'Ø³ÙØ§Ø±Ø´Ø§Øª Ù…Ù†', emptyCart: 'Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª', noOrders: 'Ø³ÙØ§Ø±Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'
            },
            en: {
                siteName: 'Royal Restaurant', siteSlogan: 'Experience Luxury Taste', heroTitle: 'Welcome to Royal Flavors', heroSubtitle: 'Online ordering of premium quality food', allItems: 'All', cart: 'Cart', account: 'Account', support: 'Support', myOrders: 'My Orders', shoppingCart: 'Shopping Cart', total: 'Total:', checkout: 'Checkout', orderForm: 'Order Form', firstName: 'First Name', lastName: 'Last Name', phone: 'Phone', address: 'Address', location: 'Location', notes: 'Additional Notes', contactMethod: 'Contact Method', deliveryType: 'Delivery Type', delivery: 'Delivery', pickup: 'Pickup', totalPayable: 'Total Payable:', payWithPaypal: 'Pay with PayPal', myAccount: 'My Account', guestUser: 'Guest User', supportTitle: 'Support', callUs: 'Call Us', myOrdersTitle: 'My Orders', emptyCart: 'Cart is empty', noOrders: 'No orders found'
            },
            ar: {
                siteName: 'Ù…Ø·Ø¹Ù… Ø±ÙˆÙŠØ§Ù„', siteSlogan: 'ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø·Ø¹Ù… Ø§Ù„ÙØ§Ø®Ø±', heroTitle: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ù†ÙƒÙ‡Ø§Øª Ø§Ù„Ù…Ù„ÙƒÙŠØ©', heroSubtitle: 'Ø·Ù„Ø¨ Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„ÙØ§Ø®Ø± Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', allItems: 'Ø§Ù„ÙƒÙ„', cart: 'Ø§Ù„Ø³Ù„Ø©', account: 'Ø§Ù„Ø­Ø³Ø§Ø¨', support: 'Ø§Ù„Ø¯Ø¹Ù…', myOrders: 'Ø·Ù„Ø¨Ø§ØªÙŠ', shoppingCart: 'Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚', total: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:', checkout: 'Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨', orderForm: 'Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø¨', firstName: 'Ø§Ù„Ø§Ø³Ù…', lastName: 'Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©', phone: 'Ø§Ù„Ù‡Ø§ØªÙ', address: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', location: 'Ø§Ù„Ù…ÙˆÙ‚Ø¹', notes: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©', contactMethod: 'Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØ§ØµÙ„', deliveryType: 'Ù†ÙˆØ¹ Ø§Ù„ØªØ³Ù„ÙŠÙ…', delivery: 'ØªÙˆØµÙŠÙ„', pickup: 'Ø§Ø³ØªÙ„Ø§Ù…', totalPayable: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚:', payWithPaypal: 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± PayPal', myAccount: 'Ø­Ø³Ø§Ø¨ÙŠ', guestUser: 'Ø²Ø§Ø¦Ø±', supportTitle: 'Ø§Ù„Ø¯Ø¹Ù…', callUs: 'Ø§ØªØµÙ„ Ø¨Ù†Ø§', myOrdersTitle: 'Ø·Ù„Ø¨Ø§ØªÙŠ', emptyCart: 'Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©', noOrders: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª'
            }
        };

        // State
        let currentLang = localStorage.getItem('lang') || 'fa';
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let products = [];
        let categories = [];
        let currentCategory = 'all';
        let myOrderIds = JSON.parse(localStorage.getItem('myOrderIds')) || [];

        // Initialization
        document.addEventListener('DOMContentLoaded', () => {
            fetchData();
            setLanguage(currentLang);
            updateCartBadge();
            setupEventListeners();
            checkErrors();
        });

        async function fetchData() {
            try {
                const response = await fetch('/api/data');
                const data = await response.json();
                products = data.products;
                categories = data.categories;
                loadCategories();
                loadProducts();
            } catch (error) {
                console.error('Error fetching data:', error);
                showToast('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª');
            }
        }

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            
            const isRTL = lang === 'fa' || lang === 'ar';
            document.documentElement.setAttribute('dir', isRTL ? 'rtl' : 'ltr');
            document.documentElement.setAttribute('lang', lang);
            
            const flags = { fa: 'ğŸ‡®ğŸ‡·', en: 'ğŸ‡¬ğŸ‡§', ar: 'ğŸ‡¸ğŸ‡¦' };
            document.getElementById('currentLang').textContent = flags[lang];
            document.getElementById('langDropdown').classList.add('hidden');
            
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
            
            loadCategories();
            loadProducts();
        }

        function loadCategories() {
            const container = document.getElementById('categoriesContainer');
            const allBtnText = translations[currentLang]?.allItems || 'Ù‡Ù…Ù‡';
            
            let html = `<button onclick="filterByCategory('all')" class="category-btn ${currentCategory === 'all' ? 'category-active' : ''} px-5 py-2 rounded-full gold-border whitespace-nowrap transition-all" data-category="all">${allBtnText}</button>`;
            
            categories.forEach(cat => {
                const name = cat.name[currentLang] || cat.name.fa;
                html += `<button onclick="filterByCategory('${cat.id}')" class="category-btn ${currentCategory === cat.id ? 'category-active' : ''} px-5 py-2 rounded-full gold-border whitespace-nowrap transition-all" data-category="${cat.id}">${name}</button>`;
            });
            
            container.innerHTML = html;
        }

        function filterByCategory(categoryId) {
            currentCategory = categoryId;
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('category-active');
                if (btn.getAttribute('data-category') === categoryId) btn.classList.add('category-active');
            });
            loadProducts();
        }

        function loadProducts() {
            const container = document.getElementById('productsGrid');
            let filtered = currentCategory === 'all' ? products : products.filter(p => p.category === currentCategory);
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center py-10 text-gray-400">Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</div>';
                return;
            }
            
            container.innerHTML = filtered.map(p => {
                const name = p.name[currentLang] || p.name.fa;
                const finalPrice = p.discount ? (p.price * (1 - p.discount / 100)).toFixed(2) : p.price.toFixed(2);
                
                return `
                    <div class="bg-[#1A1A1A] rounded-2xl gold-border overflow-hidden card-hover">
                        <div class="relative">
                            <img src="${p.image}" alt="${name}" class="product-image w-full">
                            ${p.discount ? `<span class="absolute top-2 right-2 discount-badge text-white text-xs px-2 py-1 rounded-full">${p.discount}% OFF</span>` : ''}
                        </div>
                        <div class="p-3">
                            <h3 class="font-bold text-sm mb-1 truncate">${name}</h3>
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-[#D4AF37] font-bold">${finalPrice} OMR</span>
                                ${p.discount ? `<span class="text-xs text-gray-500 line-through">${p.price.toFixed(2)}</span>` : ''}
                            </div>
                            <div class="flex gap-2">
                                <button onclick="showProductDetails('${p.id}')" class="flex-1 py-2 rounded-lg gold-border text-xs hover:bg-white/5 transition"><i class="fas fa-info-circle"></i></button>
                                <button onclick="addToCart('${p.id}')" class="flex-1 py-2 rounded-lg btn-gold text-black text-xs font-bold"><i class="fas fa-plus"></i></button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showProductDetails(id) {
            const p = products.find(x => x.id === id);
            if (!p) return;
            const name = p.name[currentLang] || p.name.fa;
            const desc = p.description[currentLang] || p.description.fa;
            const price = p.discount ? (p.price * (1 - p.discount / 100)).toFixed(2) : p.price.toFixed(2);

            document.getElementById('productModalContent').innerHTML = `
                <img src="${p.image}" alt="${name}" class="w-full h-64 object-cover">
                <div class="p-4">
                    <h3 class="text-2xl font-bold gold-gradient mb-2">${name}</h3>
                    <p class="text-gray-400 mb-4">${desc}</p>
                    <div class="flex items-center gap-3 mb-4">
                        <span class="text-2xl text-[#D4AF37] font-bold">${price} OMR</span>
                    </div>
                    <button onclick="addToCart('${p.id}'); closeProductModal();" class="w-full btn-gold text-black font-bold py-4 rounded-xl">Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</button>
                </div>
            `;
            document.getElementById('productModal').classList.remove('hidden');
        }

        function closeProductModal() { document.getElementById('productModal').classList.add('hidden'); }

        // Cart
        function addToCart(id) {
            const existing = cart.find(x => x.id === id);
            if (existing) existing.quantity++;
            else cart.push({ id, quantity: 1 });
            saveCart();
            showToast('Ø¨Ù‡ Ø³Ø¨Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
        }

        function updateCartQuantity(id, change) {
            const item = cart.find(x => x.id === id);
            if (!item) return;
            item.quantity += change;
            if (item.quantity <= 0) cart = cart.filter(x => x.id !== id);
            saveCart();
            renderCartItems();
        }

        function removeFromCart(id) {
            cart = cart.filter(x => x.id !== id);
            saveCart();
            renderCartItems();
        }

        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartBadge();
        }

        function updateCartBadge() {
            const badge = document.getElementById('cartBadge');
            const count = cart.reduce((a, b) => a + b.quantity, 0);
            badge.textContent = count;
            count > 0 ? badge.classList.remove('hidden') : badge.classList.add('hidden');
        }

        function showCart() { renderCartItems(); document.getElementById('cartModal').classList.remove('hidden'); }
        function closeCart() { document.getElementById('cartModal').classList.add('hidden'); }

        function renderCartItems() {
            const container = document.getElementById('cartItems');
            if (cart.length === 0) {
                container.innerHTML = `<div class="text-center py-10 text-gray-400">${translations[currentLang].emptyCart}</div>`;
                document.getElementById('cartTotal').textContent = '0 OMR';
                return;
            }
            let total = 0;
            container.innerHTML = cart.map(item => {
                const p = products.find(x => x.id === item.id);
                if (!p) return '';
                const price = p.discount ? (p.price * (1 - p.discount / 100)) : p.price;
                total += price * item.quantity;
                const name = p.name[currentLang] || p.name.fa;
                return `
                    <div class="flex items-center gap-3 p-3 rounded-xl gold-border mb-2">
                        <img src="${p.image}" class="w-16 h-16 rounded-lg object-cover">
                        <div class="flex-1">
                            <h4 class="font-bold text-sm">${name}</h4>
                            <div class="text-[#D4AF37]">${price.toFixed(2)} OMR</div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="updateCartQuantity('${item.id}', -1)" class="w-8 h-8 rounded-full gold-border flex items-center justify-center hover:bg-white/5">-</button>
                            <span class="w-8 text-center">${item.quantity}</span>
                            <button onclick="updateCartQuantity('${item.id}', 1)" class="w-8 h-8 rounded-full gold-border flex items-center justify-center hover:bg-white/5">+</button>
                        </div>
                        <button onclick="removeFromCart('${item.id}')" class="text-red-500 w-8"><i class="fas fa-trash"></i></button>
                    </div>
                `;
            }).join('');
            document.getElementById('cartTotal').textContent = total.toFixed(2) + ' OMR';
        }

        // Checkout
        function showCheckout() {
            if (cart.length === 0) return showToast('Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª');
            closeCart();
            updateCheckoutTotal();
            document.getElementById('checkoutModal').classList.remove('hidden');
        }
        function closeCheckout() { document.getElementById('checkoutModal').classList.add('hidden'); }

        function updateCheckoutTotal() {
            let total = 0;
            cart.forEach(item => {
                const p = products.find(x => x.id === item.id);
                if (p) total += (p.discount ? p.price * (1 - p.discount / 100) : p.price) * item.quantity;
            });
            document.getElementById('checkoutTotalOMR').textContent = total.toFixed(2) + ' OMR';
            document.getElementById('checkoutTotalUSD').textContent = 'â‰ˆ $' + (total * 2.6).toFixed(2) + ' USD';
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    pos => { document.getElementById('locationInput').value = `${pos.coords.latitude}, ${pos.coords.longitude}`; showToast('Ù„ÙˆÚ©ÛŒØ´Ù† Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯'); },
                    err => showToast('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù„ÙˆÚ©ÛŒØ´Ù†')
                );
            } else showToast('Ù…Ø±ÙˆØ±Ú¯Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯');
        }

        document.getElementById('orderForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('payButton');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...';

            const formData = new FormData(e.target);
            const data = {
                customer: Object.fromEntries(formData),
                items: cart,
                total_omr: 0 // Calculated on server
            };

            try {
                const res = await fetch('/api/order/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (res.ok) {
                    const result = await res.json();
                    window.location.href = result.approval_url;
                } else {
                    throw new Error('Order creation failed');
                }
            } catch (error) {
                console.error(error);
                showToast('Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´');
                btn.disabled = false;
                btn.innerHTML = 'Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ PayPal';
            }
        });

        // Orders
        async function showOrders() {
            const list = document.getElementById('ordersList');
            list.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin"></i></div>';
            document.getElementById('ordersModal').classList.remove('hidden');

            // Fetch stored orders status
            const myOrders = [];
            for (const oid of myOrderIds) {
                try {
                    const res = await fetch(`/api/order/${oid}`);
                    if (res.ok) myOrders.push(await res.json());
                } catch(e) {}
            }

            if (myOrders.length === 0) {
                list.innerHTML = `<div class="text-center py-10 text-gray-400">${translations[currentLang].noOrders}</div>`;
                return;
            }

            list.innerHTML = myOrders.reverse().map(o => `
                <div class="bg-[#0D0D0D] rounded-xl gold-border p-4">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <div class="font-bold">#${o.id}</div>
                            <div class="text-sm text-gray-400">${new Date(o.date).toLocaleDateString()}</div>
                        </div>
                        <span class="text-xs px-3 py-1 rounded-full ${getStatusColor(o.status)}">${o.status}</span>
                    </div>
                    <div class="text-sm text-gray-400 mb-2">${o.items.length} Ù…Ø­ØµÙˆÙ„</div>
                    <div class="flex justify-between pt-2 border-t border-white/10">
                        <span>Ù…Ø¬Ù…ÙˆØ¹:</span>
                        <span class="text-[#D4AF37] font-bold">${o.total_omr.toFixed(2)} OMR</span>
                    </div>
                </div>
            `).join('');
        }

        function getStatusColor(s) {
            if(s==='pending_payment') return 'bg-yellow-500';
            if(s==='confirmed') return 'bg-green-500';
            return 'bg-blue-500';
        }

        function closeOrders() { document.getElementById('ordersModal').classList.add('hidden'); }
        function showAccount() { document.getElementById('accountModal').classList.remove('hidden'); }
        function closeAccount() { document.getElementById('accountModal').classList.add('hidden'); }
        function showSupport() { document.getElementById('supportModal').classList.remove('hidden'); }
        function closeSupport() { document.getElementById('supportModal').classList.add('hidden'); }

        // Utils
        function setupEventListeners() {
            document.getElementById('langBtn').addEventListener('click', () => {
                document.getElementById('langDropdown').classList.toggle('hidden');
            });
            
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const name = this.name;
                    document.querySelectorAll(`input[name="${name}"]`).forEach(r => {
                        r.closest('label').classList.remove('bg-[#D4AF37]/20', 'border-[#D4AF37]');
                    });
                    if (this.checked) {
                        this.closest('label').classList.add('bg-[#D4AF37]/20', 'border-[#D4AF37]');
                    }
                });
            });
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = msg;
            t.classList.remove('hidden');
            setTimeout(() => t.classList.add('hidden'), 3000);
        }

        function checkErrors() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('error')) {
                showToast('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø®Øª ÛŒØ§ Ø§Ù†ØµØ±Ø§Ù');
            }
        }
    </script>
</body>
</html>