<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª | Royal Restaurant</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { font-family: 'Vazirmatn', sans-serif; }
        :root {
            --gold: #D4AF37;
            --gold-light: #F4E4BA;
            --dark: #0D0D0D;
            --dark-light: #1A1A1A;
        }
        body {
            background: linear-gradient(135deg, #0D0D0D 0%, #1A1A1A 50%, #0D0D0D 100%);
            min-height: 100vh;
            color: white;
        }
        .gold-gradient {
            background: linear-gradient(135deg, #D4AF37 0%, #F4E4BA 50%, #D4AF37 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .gold-border { border: 1px solid rgba(212, 175, 55, 0.3); }
        .gold-glow { box-shadow: 0 0 30px rgba(212, 175, 55, 0.2); }
        .btn-gold {
            background: linear-gradient(135deg, #D4AF37 0%, #B8962D 100%);
            color: black;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .btn-gold:hover {
            background: linear-gradient(135deg, #F4E4BA 0%, #D4AF37 100%);
            transform: scale(1.02);
        }
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        .btn-danger:hover {
            background: linear-gradient(135deg, #ff6b6b 0%, #e74c3c 100%);
        }
        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
            color: white;
        }
        .btn-info {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .tab-active {
            background: linear-gradient(135deg, #D4AF37 0%, #B8962D 100%);
            color: #0D0D0D;
        }
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
        }
        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        input, textarea, select {
            background: #2D2D2D !important;
            border: 1px solid rgba(212, 175, 55, 0.3) !important;
            color: white !important;
            outline: none;
        }
        input:focus, textarea:focus, select:focus { 
            border-color: #D4AF37 !important;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.2);
        }
        .status-pending { background: #f39c12; color: black; }
        .status-confirmed { background: #27ae60; color: white; }
        .status-preparing { background: #3498db; color: white; }
        .status-shipped { background: #9b59b6; color: white; }
        .status-delivered { background: #1abc9c; color: white; }
        .status-cancelled { background: #e74c3c; color: white; }
        
        .card {
            background: linear-gradient(145deg, #1a1a1a 0%, #222 100%);
            border: 1px solid rgba(212, 175, 55, 0.2);
            transition: all 0.3s ease;
        }
        .card:hover {
            border-color: rgba(212, 175, 55, 0.5);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .stat-card {
            background: linear-gradient(145deg, #1a1a1a 0%, #252525 100%);
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 z-[200] flex items-center justify-center bg-black">
        <div class="bg-[#1A1A1A] rounded-2xl gold-border gold-glow p-8 w-full max-w-sm mx-4 animate-fade-in">
            <div class="text-center mb-6">
                <div class="w-20 h-20 rounded-full bg-gradient-to-br from-[#D4AF37] to-[#B8962D] mx-auto mb-4 flex items-center justify-center shadow-lg shadow-[#D4AF37]/30">
                    <i class="fas fa-crown text-3xl text-black"></i>
                </div>
                <h2 class="text-2xl font-bold gold-gradient">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
                <p class="text-gray-400 text-sm mt-1">Royal Restaurant</p>
            </div>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="text-sm text-gray-400 block mb-1">ØªÙˆÚ©Ù† Ø§Ø¯Ù…ÛŒÙ†</label>
                    <input type="password" id="adminTokenInput" placeholder="ØªÙˆÚ©Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." required 
                           class="w-full p-4 rounded-xl text-center text-lg tracking-widest">
                </div>
                <button type="submit" class="w-full btn-gold py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2">
                    <i class="fas fa-sign-in-alt"></i>
                    ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù¾Ù†Ù„
                </button>
            </form>
            <p id="loginError" class="text-red-500 text-center mt-4 hidden">ØªÙˆÚ©Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª</p>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Header -->
        <header class="bg-[#111]/95 backdrop-blur-md border-b border-[#D4AF37]/20 sticky top-0 z-50">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-[#D4AF37] to-[#B8962D] flex items-center justify-center">
                            <i class="fas fa-crown text-black"></i>
                        </div>
                        <div>
                            <h1 class="text-lg font-bold gold-gradient">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h1>
                            <p class="text-[10px] text-gray-400">Royal Restaurant</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <a href="/" class="px-4 py-2 rounded-lg gold-border hover:bg-white/5 transition text-sm flex items-center gap-2">
                            <i class="fas fa-external-link-alt"></i>
                            Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø³Ø§ÛŒØª
                        </a>
                        <button onclick="logout()" class="px-4 py-2 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30 transition text-sm flex items-center gap-2">
                            <i class="fas fa-sign-out-alt"></i>
                            Ø®Ø±ÙˆØ¬
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="bg-[#151515] border-b border-white/5">
            <div class="container mx-auto px-4">
                <div class="flex gap-1 overflow-x-auto scrollbar-hide py-3">
                    <button onclick="showTab('dashboard')" class="tab-btn tab-active px-5 py-2 rounded-lg whitespace-nowrap transition-all flex items-center gap-2" data-tab="dashboard">
                        <i class="fas fa-chart-pie"></i> Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
                    </button>
                    <button onclick="showTab('products')" class="tab-btn px-5 py-2 rounded-lg whitespace-nowrap transition-all flex items-center gap-2 gold-border hover:bg-white/5" data-tab="products">
                        <i class="fas fa-utensils"></i> Ù…Ø­ØµÙˆÙ„Ø§Øª
                    </button>
                    <button onclick="showTab('categories')" class="tab-btn px-5 py-2 rounded-lg whitespace-nowrap transition-all flex items-center gap-2 gold-border hover:bg-white/5" data-tab="categories">
                        <i class="fas fa-tags"></i> Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
                    </button>
                    <button onclick="showTab('orders')" class="tab-btn px-5 py-2 rounded-lg whitespace-nowrap transition-all flex items-center gap-2 gold-border hover:bg-white/5" data-tab="orders">
                        <i class="fas fa-shopping-bag"></i> Ø³ÙØ§Ø±Ø´Ø§Øª
                    </button>
                    <button onclick="showTab('backup')" class="tab-btn px-5 py-2 rounded-lg whitespace-nowrap transition-all flex items-center gap-2 gold-border hover:bg-white/5" data-tab="backup">
                        <i class="fas fa-database"></i> Ø¨Ú©Ø§Ù¾
                    </button>
                </div>
            </div>
        </nav>

        <!-- Content -->
        <main class="container mx-auto px-4 py-6">
            <!-- Dashboard Tab -->
            <div id="dashboardTab" class="tab-content">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="stat-card rounded-2xl p-5 gold-border">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center">
                                <i class="fas fa-shopping-bag text-blue-400 text-xl"></i>
                            </div>
                            <span class="text-xs text-gray-500">Ø§Ù…Ø±ÙˆØ²</span>
                        </div>
                        <div class="text-3xl font-bold text-white" id="statOrders">0</div>
                        <div class="text-sm text-gray-400">Ú©Ù„ Ø³ÙØ§Ø±Ø´Ø§Øª</div>
                    </div>
                    <div class="stat-card rounded-2xl p-5 gold-border">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-12 h-12 rounded-xl bg-green-500/20 flex items-center justify-center">
                                <i class="fas fa-coins text-green-400 text-xl"></i>
                            </div>
                            <span class="text-xs text-gray-500">OMR</span>
                        </div>
                        <div class="text-3xl font-bold text-[#D4AF37]" id="statRevenue">0</div>
                        <div class="text-sm text-gray-400">Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„</div>
                    </div>
                    <div class="stat-card rounded-2xl p-5 gold-border">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center">
                                <i class="fas fa-box text-purple-400 text-xl"></i>
                            </div>
                        </div>
                        <div class="text-3xl font-bold text-white" id="statProducts">0</div>
                        <div class="text-sm text-gray-400">Ù…Ø­ØµÙˆÙ„Ø§Øª</div>
                    </div>
                    <div class="stat-card rounded-2xl p-5 gold-border">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-12 h-12 rounded-xl bg-orange-500/20 flex items-center justify-center">
                                <i class="fas fa-clock text-orange-400 text-xl"></i>
                            </div>
                        </div>
                        <div class="text-3xl font-bold text-orange-400" id="statPending">0</div>
                        <div class="text-sm text-gray-400">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                    </div>
                </div>

                <!-- Recent Orders -->
                <div class="card rounded-2xl p-6">
                    <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="fas fa-history text-[#D4AF37]"></i>
                        Ø¢Ø®Ø±ÛŒÙ† Ø³ÙØ§Ø±Ø´Ø§Øª
                    </h3>
                    <div id="recentOrders" class="space-y-3">
                        <!-- Recent orders will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Products Tab -->
            <div id="productsTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª</h2>
                    <button onclick="openProductModal()" class="btn-gold px-5 py-3 rounded-xl flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯
                    </button>
                </div>
                <div id="productsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Products will be loaded here -->
                </div>
            </div>

            <!-- Categories Tab -->
            <div id="categoriesTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</h2>
                    <button onclick="openCategoryModal()" class="btn-gold px-5 py-3 rounded-xl flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯
                    </button>
                </div>
                <div id="categoriesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Categories will be loaded here -->
                </div>
            </div>

            <!-- Orders Tab -->
            <div id="ordersTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´Ø§Øª</h2>
                    <div class="flex gap-2">
                        <select id="orderStatusFilter" onchange="filterOrders()" class="px-4 py-2 rounded-lg">
                            <option value="all">Ù‡Ù…Ù‡ ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§</option>
                            <option value="pending_payment">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª</option>
                            <option value="confirmed">ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡</option>
                            <option value="preparing">Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ</option>
                            <option value="shipped">Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡</option>
                            <option value="delivered">ØªØ­ÙˆÛŒÙ„ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡</option>
                        </select>
                    </div>
                </div>
                <div id="ordersList" class="space-y-4">
                    <!-- Orders will be loaded here -->
                </div>
            </div>

            <!-- Backup Tab -->
            <div id="backupTab" class="tab-content hidden">
                <h2 class="text-xl font-bold mb-6">Ø¨Ú©Ø§Ù¾ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="card rounded-2xl p-6">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-14 h-14 rounded-xl bg-green-500/20 flex items-center justify-center">
                                <i class="fas fa-download text-green-400 text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg">Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¨Ú©Ø§Ù¾</h3>
                                <p class="text-sm text-gray-400">Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ø§Ù…Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø§ÛŒØª</p>
                            </div>
                        </div>
                        <p class="text-gray-400 text-sm mb-4">Ø´Ø§Ù…Ù„ Ù…Ø­ØµÙˆÙ„Ø§ØªØŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ùˆ Ø³ÙØ§Ø±Ø´Ø§Øª</p>
                        <button onclick="downloadBackup()" class="w-full btn-success py-3 rounded-xl font-bold flex items-center justify-center gap-2">
                            <i class="fas fa-file-download"></i>
                            Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ JSON
                        </button>
                    </div>
                    <div class="card rounded-2xl p-6">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-14 h-14 rounded-xl bg-blue-500/20 flex items-center justify-center">
                                <i class="fas fa-upload text-blue-400 text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg">Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¨Ú©Ø§Ù¾</h3>
                                <p class="text-sm text-gray-400">Ø¢Ù¾Ù„ÙˆØ¯ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</p>
                            </div>
                        </div>
                        <p class="text-gray-400 text-sm mb-4">ÙØ§ÛŒÙ„ JSON Ø¨Ú©Ø§Ù¾ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</p>
                        <input type="file" id="backupFileInput" accept=".json" class="hidden" onchange="restoreBackup(event)">
                        <button onclick="document.getElementById('backupFileInput').click()" class="w-full btn-info py-3 rounded-xl font-bold flex items-center justify-center gap-2">
                            <i class="fas fa-file-upload"></i>
                            Ø§Ù†ØªØ®Ø§Ø¨ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="fixed inset-0 z-[150] hidden overflow-y-auto">
        <div class="modal-backdrop absolute inset-0" onclick="closeProductModal()"></div>
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="relative bg-[#1A1A1A] rounded-2xl gold-border w-full max-w-lg animate-fade-in shadow-2xl max-h-[90vh] overflow-y-auto">
                <div class="sticky top-0 bg-[#1A1A1A] p-4 border-b border-white/10 flex items-center justify-between z-10 rounded-t-2xl">
                    <h3 class="text-xl font-bold gold-gradient" id="productModalTitle">Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„</h3>
                    <button onclick="closeProductModal()" class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center hover:bg-red-500/20">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="productForm" class="p-5 space-y-4">
                    <input type="hidden" id="productId">
                    
                    <div class="grid grid-cols-1 gap-4">
                        <div>
                            <label class="text-sm text-gray-400 block mb-1">Ù†Ø§Ù… (ÙØ§Ø±Ø³ÛŒ) *</label>
                            <input type="text" id="productNameFa" required class="w-full p-3 rounded-xl">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 block mb-1">Ù†Ø§Ù… (Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ) *</label>
                            <input type="text" id="productNameEn" required class="w-full p-3 rounded-xl" dir="ltr">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 block mb-1">Ù†Ø§Ù… (Ø¹Ø±Ø¨ÛŒ) *</label>
                            <input type="text" id="productNameAr" required class="w-full p-3 rounded-xl">
                        </div>
                    </div>
                    
                    <div>
                        <label class="text-sm text-gray-400 block mb-1">ØªÙˆØ¶ÛŒØ­Ø§Øª (ÙØ§Ø±Ø³ÛŒ)</label>
                        <textarea id="productDescFa" rows="2" class="w-full p-3 rounded-xl resize-none"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm text-gray-400 block mb-1">Ù‚ÛŒÙ…Øª (OMR) *</label>
                            <input type="number" id="productPrice" step="0.01" required class="w-full p-3 rounded-xl" dir="ltr">
                        </div>
                        <div>
                            <label class="text-sm text-gray-400 block mb-1">ØªØ®ÙÛŒÙ (%)</label>
                            <input type="number" id="productDiscount" min="0" max="100" value="0" class="w-full p-3 rounded-xl" dir="ltr">
                        </div>
                    </div>
                    
                    <div>
                        <label class="text-sm text-gray-400 block mb-1">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ *</label>
                        <select id="productCategory" required class="w-full p-3 rounded-xl">
                            <!-- Options loaded dynamically -->
                        </select>
                    </div>
                    
                    <div>
                        <label class="text-sm text-gray-400 block mb-1">Ù„ÛŒÙ†Ú© ØªØµÙˆÛŒØ± *</label>
                        <input type="url" id="productImage" required class="w-full p-3 rounded-xl" dir="ltr" placeholder="https://...">
                    </div>
                    
                    <div id="productImagePreview" class="hidden">
                        <img src="" alt="Preview" class="w-full h-40 object-cover rounded-xl">
                    </div>
                    
                    <button type="submit" class="w-full btn-gold py-4 rounded-xl font-bold text-lg">
                        <i class="fas fa-save ml-2"></i>
                        Ø°Ø®ÛŒØ±Ù‡ Ù…Ø­ØµÙˆÙ„
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="categoryModal" class="fixed inset-0 z-[150] hidden">
        <div class="modal-backdrop absolute inset-0" onclick="closeCategoryModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-[#1A1A1A] rounded-2xl gold-border w-full max-w-md p-6 animate-fade-in shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold gold-gradient" id="categoryModalTitle">Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</h3>
                <button onclick="closeCategoryModal()" class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="categoryForm" class="space-y-4">
                <input type="hidden" id="categoryId">
                <div>
                    <label class="text-sm text-gray-400 block mb-1">Ù†Ø§Ù… (ÙØ§Ø±Ø³ÛŒ) *</label>
                    <input type="text" id="categoryNameFa" required class="w-full p-3 rounded-xl">
                </div>
                <div>
                    <label class="text-sm text-gray-400 block mb-1">Ù†Ø§Ù… (Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ) *</label>
                    <input type="text" id="categoryNameEn" required class="w-full p-3 rounded-xl" dir="ltr">
                </div>
                <div>
                    <label class="text-sm text-gray-400 block mb-1">Ù†Ø§Ù… (Ø¹Ø±Ø¨ÛŒ) *</label>
                    <input type="text" id="categoryNameAr" required class="w-full p-3 rounded-xl">
                </div>
                <button type="submit" class="w-full btn-gold py-4 rounded-xl font-bold">
                    <i class="fas fa-save ml-2"></i>
                    Ø°Ø®ÛŒØ±Ù‡
                </button>
            </form>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div id="orderDetailModal" class="fixed inset-0 z-[150] hidden overflow-y-auto">
        <div class="modal-backdrop absolute inset-0" onclick="closeOrderDetail()"></div>
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="relative bg-[#1A1A1A] rounded-2xl gold-border w-full max-w-2xl animate-fade-in shadow-2xl max-h-[90vh] overflow-y-auto">
                <div class="sticky top-0 bg-[#1A1A1A] p-4 border-b border-white/10 flex items-center justify-between z-10 rounded-t-2xl">
                    <h3 class="text-xl font-bold gold-gradient">Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ§Ø±Ø´</h3>
                    <button onclick="closeOrderDetail()" class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="orderDetailContent" class="p-5">
                    <!-- Order details loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-[#222] text-white px-6 py-3 rounded-full gold-border shadow-2xl z-[200] hidden transition-all transform scale-90 opacity-0 flex items-center gap-3">
        <i id="toastIcon" class="fas fa-check-circle text-green-500"></i>
        <span id="toastMsg" class="text-sm font-bold"></span>
    </div>

    <script>
        // ============ State ============
        let adminToken = localStorage.getItem('adminToken') || '';
        let data = { products: [], categories: [], orders: [] };
        let currentOrderFilter = 'all';

        // ============ Initialization ============
        document.addEventListener('DOMContentLoaded', () => {
            if (adminToken) {
                verifyToken();
            }
        });

        // ============ Authentication ============
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const token = document.getElementById('adminTokenInput').value;
            
            try {
                const res = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token })
                });
                
                if (res.ok) {
                    adminToken = token;
                    localStorage.setItem('adminToken', token);
                    document.getElementById('loginError').classList.add('hidden');
                    showDashboard();
                } else {
                    document.getElementById('loginError').classList.remove('hidden');
                }
            } catch (error) {
                showToast('Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±', 'error');
            }
        });

        async function verifyToken() {
            try {
                const res = await fetch('/api/admin/full-data', {
                    headers: { 'X-Admin-Token': adminToken }
                });
                
                if (res.ok) {
                    showDashboard();
                } else {
                    localStorage.removeItem('adminToken');
                    adminToken = '';
                }
            } catch {
                localStorage.removeItem('adminToken');
            }
        }

        function logout() {
            localStorage.removeItem('adminToken');
            adminToken = '';
            location.reload();
        }

        async function showDashboard() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            await loadData();
        }

        // ============ Data Loading ============
        async function loadData() {
            try {
                const res = await fetch('/api/admin/full-data', {
                    headers: { 'X-Admin-Token': adminToken }
                });
                
                if (!res.ok) throw new Error('Unauthorized');
                data = await res.json();
                
                renderDashboard();
                renderProducts();
                renderCategories();
                renderOrders();
            } catch (error) {
                showToast('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª', 'error');
            }
        }

        // ============ Dashboard ============
        function renderDashboard() {
            // Stats
            document.getElementById('statOrders').textContent = data.orders.length;
            document.getElementById('statProducts').textContent = data.products.length;
            
            const revenue = data.orders
                .filter(o => o.paid)
                .reduce((sum, o) => sum + (o.total_omr || 0), 0);
            document.getElementById('statRevenue').textContent = revenue.toFixed(2);
            
            const pending = data.orders.filter(o => o.status === 'pending_payment' || o.status === 'confirmed').length;
            document.getElementById('statPending').textContent = pending;
            
            // Recent Orders
            const recentContainer = document.getElementById('recentOrders');
            const recent = data.orders.slice(-5).reverse();
            
            if (recent.length === 0) {
                recentContainer.innerHTML = '<div class="text-center text-gray-500 py-8">Ø³ÙØ§Ø±Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>';
                return;
            }
            
            recentContainer.innerHTML = recent.map(o => `
                <div class="flex items-center justify-between p-4 rounded-xl bg-[#222] gold-border cursor-pointer hover:bg-white/5 transition" onclick="openOrderDetail('${o.id}')">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-[#D4AF37]/20 flex items-center justify-center">
                            <i class="fas fa-receipt text-[#D4AF37]"></i>
                        </div>
                        <div>
                            <div class="font-bold">${o.customer.firstName} ${o.customer.lastName}</div>
                            <div class="text-xs text-gray-400">#${o.id.slice(-6)}</div>
                        </div>
                    </div>
                    <div class="text-left">
                        <div class="font-bold text-[#D4AF37]">${(o.total_omr || 0).toFixed(2)} OMR</div>
                        <span class="text-xs px-2 py-1 rounded ${getStatusClass(o.status)}">${getStatusText(o.status)}</span>
                    </div>
                </div>
            `).join('');
        }

        // ============ Products ============
        function renderProducts() {
            const container = document.getElementById('productsList');
            
            if (data.products.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-10">Ù…Ø­ØµÙˆÙ„ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>';
                return;
            }
            
            container.innerHTML = data.products.map(p => `
                <div class="card rounded-2xl overflow-hidden">
                    <div class="relative h-40">
                        <img src="${p.image}" alt="${p.name.fa}" class="w-full h-full object-cover">
                        ${p.discount ? `<div class="absolute top-2 right-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-full">${p.discount}%</div>` : ''}
                    </div>
                    <div class="p-4">
                        <h4 class="font-bold mb-1">${p.name.fa}</h4>
                        <div class="flex items-center gap-2 mb-3">
                            <span class="text-[#D4AF37] font-bold">${p.price} OMR</span>
                            <span class="text-xs text-gray-400">| ${getCategoryName(p.category)}</span>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editProduct('${p.id}')" class="flex-1 py-2 rounded-lg gold-border hover:bg-white/5 transition text-sm">
                                <i class="fas fa-edit ml-1"></i> ÙˆÛŒØ±Ø§ÛŒØ´
                            </button>
                            <button onclick="deleteProduct('${p.id}')" class="flex-1 py-2 rounded-lg btn-danger text-sm">
                                <i class="fas fa-trash ml-1"></i> Ø­Ø°Ù
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getCategoryName(catId) {
            const cat = data.categories.find(c => c.id === catId);
            return cat ? cat.name.fa : 'Ø¨Ø¯ÙˆÙ† Ø¯Ø³ØªÙ‡';
        }

        function openProductModal(product = null) {
            document.getElementById('productModalTitle').textContent = product ? 'ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„' : 'Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„';
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            document.getElementById('productImagePreview').classList.add('hidden');
            
            // Load categories
            const select = document.getElementById('productCategory');
            select.innerHTML = data.categories.map(c => `<option value="${c.id}">${c.name.fa}</option>`).join('');
            
            if (product) {
                document.getElementById('productId').value = product.id;
                document.getElementById('productNameFa').value = product.name.fa;
                document.getElementById('productNameEn').value = product.name.en;
                document.getElementById('productNameAr').value = product.name.ar;
                document.getElementById('productDescFa').value = product.description?.fa || '';
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productDiscount').value = product.discount || 0;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productImage').value = product.image;
            }
            
            document.getElementById('productModal').classList.remove('hidden');
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.add('hidden');
        }

        function editProduct(id) {
            const product = data.products.find(p => p.id === id);
            if (product) openProductModal(product);
        }

        async function deleteProduct(id) {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ù…Ø­ØµÙˆÙ„ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) return;
            
            try {
                const res = await fetch(`/api/admin/product/${id}`, {
                    method: 'DELETE',
                    headers: { 'X-Admin-Token': adminToken }
                });
                
                if (res.ok) {
                    showToast('Ù…Ø­ØµÙˆÙ„ Ø­Ø°Ù Ø´Ø¯');
                    await loadData();
                } else {
                    throw new Error();
                }
            } catch {
                showToast('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù…Ø­ØµÙˆÙ„', 'error');
            }
        }

        document.getElementById('productForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const id = document.getElementById('productId').value || Date.now().toString();
            const product = {
                id,
                name: {
                    fa: document.getElementById('productNameFa').value,
                    en: document.getElementById('productNameEn').value,
                    ar: document.getElementById('productNameAr').value
                },
                description: {
                    fa: document.getElementById('productDescFa').value,
                    en: document.getElementById('productDescFa').value,
                    ar: document.getElementById('productDescFa').value
                },
                price: parseFloat(document.getElementById('productPrice').value),
                discount: parseInt(document.getElementById('productDiscount').value) || 0,
                category: document.getElementById('productCategory').value,
                image: document.getElementById('productImage').value
            };
            
            try {
                const res = await fetch('/api/admin/product', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Admin-Token': adminToken
                    },
                    body: JSON.stringify(product)
                });
                
                if (res.ok) {
                    showToast('Ù…Ø­ØµÙˆÙ„ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                    closeProductModal();
                    await loadData();
                } else {
                    throw new Error();
                }
            } catch {
                showToast('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù…Ø­ØµÙˆÙ„', 'error');
            }
        });

        // ============ Categories ============
        function renderCategories() {
            const container = document.getElementById('categoriesList');
            
            if (data.categories.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-10">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>';
                return;
            }
            
            container.innerHTML = data.categories.map(c => `
                <div class="card rounded-2xl p-5">
                    <div class="flex items-center gap-4 mb-4">
                        <div class="w-12 h-12 rounded-xl bg-[#D4AF37]/20 flex items-center justify-center">
                            <i class="fas fa-tag text-[#D4AF37] text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold">${c.name.fa}</h4>
                            <p class="text-xs text-gray-400">${c.name.en} | ${c.name.ar}</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="editCategory('${c.id}')" class="flex-1 py-2 rounded-lg gold-border hover:bg-white/5 transition text-sm">
                            <i class="fas fa-edit ml-1"></i> ÙˆÛŒØ±Ø§ÛŒØ´
                        </button>
                        <button onclick="deleteCategory('${c.id}')" class="flex-1 py-2 rounded-lg btn-danger text-sm">
                            <i class="fas fa-trash ml-1"></i> Ø­Ø°Ù
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function openCategoryModal(category = null) {
            document.getElementById('categoryModalTitle').textContent = category ? 'ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ' : 'Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ';
            document.getElementById('categoryForm').reset();
            document.getElementById('categoryId').value = '';
            
            if (category) {
                document.getElementById('categoryId').value = category.id;
                document.getElementById('categoryNameFa').value = category.name.fa;
                document.getElementById('categoryNameEn').value = category.name.en;
                document.getElementById('categoryNameAr').value = category.name.ar;
            }
            
            document.getElementById('categoryModal').classList.remove('hidden');
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.add('hidden');
        }

        function editCategory(id) {
            const category = data.categories.find(c => c.id === id);
            if (category) openCategoryModal(category);
        }

        async function deleteCategory(id) {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) return;
            
            try {
                const res = await fetch(`/api/admin/category/${id}`, {
                    method: 'DELETE',
                    headers: { 'X-Admin-Token': adminToken }
                });
                
                if (res.ok) {
                    showToast('Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø­Ø°Ù Ø´Ø¯');
                    await loadData();
                } else {
                    throw new Error();
                }
            } catch {
                showToast('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ', 'error');
            }
        }

        document.getElementById('categoryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const id = document.getElementById('categoryId').value || Date.now().toString();
            const category = {
                id,
                name: {
                    fa: document.getElementById('categoryNameFa').value,
                    en: document.getElementById('categoryNameEn').value,
                    ar: document.getElementById('categoryNameAr').value
                }
            };
            
            try {
                const res = await fetch('/api/admin/category', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Admin-Token': adminToken
                    },
                    body: JSON.stringify(category)
                });
                
                if (res.ok) {
                    showToast('Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                    closeCategoryModal();
                    await loadData();
                } else {
                    throw new Error();
                }
            } catch {
                showToast('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ', 'error');
            }
        });

        // ============ Orders ============
        function renderOrders() {
            const container = document.getElementById('ordersList');
            let orders = [...data.orders].reverse();
            
            if (currentOrderFilter !== 'all') {
                orders = orders.filter(o => o.status === currentOrderFilter);
            }
            
            if (orders.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-10">Ø³ÙØ§Ø±Ø´ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</div>';
                return;
            }
            
            container.innerHTML = orders.map(o => `
                <div class="card rounded-2xl p-5">
                    <div class="flex flex-wrap items-start justify-between gap-4 mb-4">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-xl bg-[#D4AF37]/20 flex items-center justify-center">
                                <i class="fas fa-shopping-bag text-[#D4AF37] text-xl"></i>
                            </div>
                            <div>
                                <div class="font-bold">${o.customer.firstName} ${o.customer.lastName}</div>
                                <div class="text-xs text-gray-400">#${o.id} | ${new Date(o.date).toLocaleDateString('fa-IR')}</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <select onchange="updateOrderStatus('${o.id}', this.value)" class="px-3 py-2 rounded-lg text-sm ${getStatusClass(o.status)}">
                                <option value="pending_payment" ${o.status === 'pending_payment' ? 'selected' : ''}>Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª</option>
                                <option value="confirmed" ${o.status === 'confirmed' ? 'selected' : ''}>ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡</option>
                                <option value="preparing" ${o.status === 'preparing' ? 'selected' : ''}>Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ</option>
                                <option value="shipped" ${o.status === 'shipped' ? 'selected' : ''}>Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡</option>
                                <option value="delivered" ${o.status === 'delivered' ? 'selected' : ''}>ØªØ­ÙˆÛŒÙ„ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4 text-sm">
                        <div class="bg-[#222] p-3 rounded-lg">
                            <div class="text-gray-400 text-xs mb-1">ØªÙ„ÙÙ†</div>
                            <div class="font-mono" dir="ltr">${o.customer.phone}</div>
                        </div>
                        <div class="bg-[#222] p-3 rounded-lg">
                            <div class="text-gray-400 text-xs mb-1">Ù†ÙˆØ¹ ØªØ­ÙˆÛŒÙ„</div>
                            <div>${o.customer.deliveryType === 'delivery' ? 'ğŸ›µ Ø§Ø±Ø³Ø§Ù„' : 'ğŸ¥¡ Ø­Ø¶ÙˆØ±ÛŒ'}</div>
                        </div>
                        <div class="bg-[#222] p-3 rounded-lg">
                            <div class="text-gray-400 text-xs mb-1">Ø±Ø§Ù‡ Ø§Ø±ØªØ¨Ø§Ø·</div>
                            <div>${o.customer.contactMethod === 'whatsapp' ? 'ÙˆØ§ØªØ³Ø§Ù¾' : 'ØªÙ„Ú¯Ø±Ø§Ù…'}</div>
                        </div>
                        <div class="bg-[#222] p-3 rounded-lg">
                            <div class="text-gray-400 text-xs mb-1">Ù…Ø¨Ù„Øº</div>
                            <div class="text-[#D4AF37] font-bold">${(o.total_omr || 0).toFixed(2)} OMR</div>
                        </div>
                    </div>
                    
                    <div class="flex flex-wrap gap-2">
                        <button onclick="openOrderDetail('${o.id}')" class="px-4 py-2 rounded-lg gold-border hover:bg-white/5 transition text-sm flex items-center gap-2">
                            <i class="fas fa-eye"></i> Ø¬Ø²Ø¦ÛŒØ§Øª
                        </button>
                        ${o.customer.location ? `
                            <a href="https://www.google.com/maps?q=${o.customer.location}" target="_blank" class="px-4 py-2 rounded-lg btn-info text-sm flex items-center gap-2">
                                <i class="fas fa-map-marker-alt"></i> Ù„ÙˆÚ©ÛŒØ´Ù†
                            </a>
                        ` : ''}
                        ${o.customer.phone ? `
                            <a href="https://wa.me/${o.customer.phone.replace(/[^0-9]/g, '')}" target="_blank" class="px-4 py-2 rounded-lg btn-success text-sm flex items-center gap-2">
                                <i class="fab fa-whatsapp"></i> Ù¾ÛŒØ§Ù…
                            </a>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function filterOrders() {
            currentOrderFilter = document.getElementById('orderStatusFilter').value;
            renderOrders();
        }

        async function updateOrderStatus(id, status) {
            try {
                const res = await fetch('/api/admin/order-status', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Admin-Token': adminToken
                    },
                    body: JSON.stringify({ id, status })
                });
                
                if (res.ok) {
                    showToast('ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯');
                    await loadData();
                } else {
                    throw new Error();
                }
            } catch {
                showToast('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª', 'error');
            }
        }

        function openOrderDetail(id) {
            const order = data.orders.find(o => o.id === id);
            if (!order) return;
            
            const itemsHtml = order.items.map(i => `
                <div class="flex justify-between items-center py-2 border-b border-white/5">
                    <div>
                        <span class="font-bold">${i.name.fa}</span>
                        <span class="text-gray-400 text-sm">Ã— ${i.quantity}</span>
                    </div>
                    <span class="text-[#D4AF37]">${(i.price * i.quantity).toFixed(2)} OMR</span>
                </div>
            `).join('');
            
            document.getElementById('orderDetailContent').innerHTML = `
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 bg-[#222] rounded-xl">
                        <div>
                            <div class="text-sm text-gray-400">Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´</div>
                            <div class="font-mono font-bold">#${order.id}</div>
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm ${getStatusClass(order.status)}">${getStatusText(order.status)}</span>
                    </div>
                    
                    <div class="p-4 bg-[#222] rounded-xl">
                        <h4 class="font-bold mb-3 flex items-center gap-2">
                            <i class="fas fa-user text-[#D4AF37]"></i> Ù…Ø´Ø®ØµØ§Øª Ù…Ø´ØªØ±ÛŒ
                        </h4>
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div><span class="text-gray-400">Ù†Ø§Ù…:</span> ${order.customer.firstName} ${order.customer.lastName}</div>
                            <div><span class="text-gray-400">ØªÙ„ÙÙ†:</span> <span dir="ltr">${order.customer.phone}</span></div>
                            <div class="col-span-2"><span class="text-gray-400">Ø¢Ø¯Ø±Ø³:</span> ${order.customer.address}</div>
                            ${order.customer.notes ? `<div class="col-span-2"><span class="text-gray-400">ØªÙˆØ¶ÛŒØ­Ø§Øª:</span> ${order.customer.notes}</div>` : ''}
                        </div>
                    </div>
                    
                    <div class="p-4 bg-[#222] rounded-xl">
                        <h4 class="font-bold mb-3 flex items-center gap-2">
                            <i class="fas fa-shopping-cart text-[#D4AF37]"></i> Ù…Ø­ØµÙˆÙ„Ø§Øª
                        </h4>
                        ${itemsHtml}
                        <div class="flex justify-between items-center pt-3 mt-3 border-t border-white/10">
                            <span class="font-bold">Ù…Ø¬Ù…ÙˆØ¹:</span>
                            <span class="text-xl font-bold text-[#D4AF37]">${(order.total_omr || 0).toFixed(2)} OMR</span>
                        </div>
                    </div>
                    
                    <div class="flex gap-3">
                        ${order.customer.location ? `
                            <a href="https://www.google.com/maps?q=${order.customer.location}" target="_blank" class="flex-1 py-3 rounded-xl btn-info font-bold text-center">
                                <i class="fas fa-map-marker-alt ml-2"></i> Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„ÙˆÚ©ÛŒØ´Ù†
                            </a>
                        ` : ''}
                        <a href="https://wa.me/${order.customer.phone?.replace(/[^0-9]/g, '')}" target="_blank" class="flex-1 py-3 rounded-xl btn-success font-bold text-center">
                            <i class="fab fa-whatsapp ml-2"></i> Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…
                        </a>
                    </div>
                </div>
            `;
            
            document.getElementById('orderDetailModal').classList.remove('hidden');
        }

        function closeOrderDetail() {
            document.getElementById('orderDetailModal').classList.add('hidden');
        }

        function getStatusClass(status) {
            const classes = {
                'pending_payment': 'status-pending',
                'confirmed': 'status-confirmed',
                'preparing': 'status-preparing',
                'shipped': 'status-shipped',
                'delivered': 'status-delivered'
            };
            return classes[status] || 'status-pending';
        }

        function getStatusText(status) {
            const texts = {
                'pending_payment': 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª',
                'confirmed': 'ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡',
                'preparing': 'Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ',
                'shipped': 'Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡',
                'delivered': 'ØªØ­ÙˆÛŒÙ„ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡'
            };
            return texts[status] || status;
        }

        // ============ Backup ============
        function downloadBackup() {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Ø¨Ú©Ø§Ù¾ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯');
        }

        async function restoreBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                
                const res = await fetch('/api/admin/restore', {
                    method: 'POST',
                    headers: { 'X-Admin-Token': adminToken },
                    body: formData
                });
                
                if (res.ok) {
                    showToast('Ø¨Ú©Ø§Ù¾ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯');
                    await loadData();
                } else {
                    throw new Error();
                }
            } catch {
                showToast('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¨Ú©Ø§Ù¾', 'error');
            }
            
            event.target.value = '';
        }

        // ============ Tabs ============
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('gold-border', 'hover:bg-white/5');
            });
            
            document.getElementById(`${tabName}Tab`).classList.remove('hidden');
            const activeBtn = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('tab-active');
                activeBtn.classList.remove('gold-border', 'hover:bg-white/5');
            }
        }

        // ============ Toast ============
        function showToast(msg, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            document.getElementById('toastMsg').textContent = msg;
            
            icon.className = type === 'success' 
                ? 'fas fa-check-circle text-green-500' 
                : 'fas fa-exclamation-circle text-red-500';
            
            toast.classList.remove('hidden', 'scale-90', 'opacity-0');
            toast.classList.add('scale-100', 'opacity-100');
            
            setTimeout(() => {
                toast.classList.remove('scale-100', 'opacity-100');
                toast.classList.add('scale-90', 'opacity-0');
                setTimeout(() => toast.classList.add('hidden'), 300);
            }, 3000);
        }
    </script>
</body>
</html>